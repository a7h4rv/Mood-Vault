<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player | Vibe-Vault</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen pb-24">
    <custom-navbar></custom-navbar>

    <main class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold" id="moodTitle">Your Playlist</h1>
            <button id="clearPlaylist" class="text-sm text-gray-400 hover:text-white flex items-center">
                <i data-feather="trash-2" class="w-4 h-4 mr-1"></i> Clear
            </button>
        </div>
        <div id="moodSections" class="space-y-8">
            <section id="focusSection" class="hidden">
                <h2 class="text-2xl font-bold mb-4 flex items-center">
                    <i data-feather="activity" class="w-6 h-6 mr-2"></i> Focus Playlist
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="focusPlaylist"></div>
            </section>

            <section id="chillSection" class="hidden">
                <h2 class="text-2xl font-bold mb-4 flex items-center">
                    <i data-feather="coffee" class="w-6 h-6 mr-2"></i> Chill Playlist
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="chillPlaylist"></div>
            </section>

            <section id="energySection" class="hidden">
                <h2 class="text-2xl font-bold mb-4 flex items-center">
                    <i data-feather="zap" class="w-6 h-6 mr-2"></i> Energy Playlist
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="energyPlaylist"></div>
            </section>

            <section id="sleepSection" class="hidden">
                <h2 class="text-2xl font-bold mb-4 flex items-center">
                    <i data-feather="moon" class="w-6 h-6 mr-2"></i> Sleep Playlist
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="sleepPlaylist"></div>
            </section>
        </div>
        <div id="emptyState" class="text-center py-16">
            <i data-feather="music" class="w-12 h-12 mx-auto text-gray-600"></i>
            <h2 class="text-xl font-medium mt-4">Your playlist is empty</h2>
            <p class="text-gray-400 mt-2">Search for songs or select a mood to get started</p>
            <div class="mt-6 flex justify-center space-x-4">
                <a href="search.html"
                    class="bg-primary-500 text-white px-4 py-2 rounded-full text-sm hover:bg-primary-600 transition-colors">
                    Search Songs
                </a>
                <a href="index.html"
                    class="bg-gray-700 text-white px-4 py-2 rounded-full text-sm hover:bg-gray-600 transition-colors">
                    Browse Moods
                </a>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                feather.replace();

                const urlParams = new URLSearchParams(window.location.search);
                const mood = urlParams.get('mood');
                const emptyState = document.getElementById('emptyState');
                const clearPlaylistBtn = document.getElementById('clearPlaylist');
                const moodTitle = document.getElementById('moodTitle');

                // Show the appropriate mood section
                if (mood) {
                    const section = document.getElementById(`${mood}Section`);
                    if (section) {
                        section.classList.remove('hidden');
                        moodTitle.textContent = `${mood.charAt(0).toUpperCase() + mood.slice(1)} Playlist`;
                        loadMoodTracks(mood, `${mood}Playlist`);
                    }
                } else {
                    // Show all sections if no specific mood
                    document.querySelectorAll('#moodSections section').forEach(section => {
                        section.classList.remove('hidden');
                    });
                    moodTitle.textContent = 'All Playlists';
                    loadAllPlaylists();
                }

                clearPlaylistBtn.addEventListener('click', () => {
                    clearPlaylist();
                    document.querySelectorAll('#moodSections > section > div').forEach(div => {
                        div.innerHTML = '';
                    });
                    emptyState.classList.remove('hidden');
                });

                async function loadMoodTracks(mood, containerId) {
                    try {
                        const tracks = await fetchMoodTracks(mood);
                        updatePlaylist(tracks, containerId);
                        if (tracks.length > 0) emptyState.classList.add('hidden');
                    } catch (error) {
                        console.error('Error loading mood tracks:', error);
                    }
                }

                async function loadAllPlaylists() {
                    const moods = ['focus', 'chill', 'energy', 'sleep'];
                    let hasTracks = false;

                    for (const mood of moods) {
                        try {
                            const tracks = await fetchMoodTracks(mood);
                            updatePlaylist(tracks, `${mood}Playlist`);
                            if (tracks.length > 0) hasTracks = true;
                        } catch (error) {
                            console.error(`Error loading ${mood} tracks:`, error);
                        }
                    }

                    if (hasTracks) emptyState.classList.add('hidden');
                }

                function updatePlaylist(tracks, containerId) {
                    if (tracks.length === 0) return;

                    const container = document.getElementById(containerId);
                    container.innerHTML = tracks.map((track, index) => `
                        <div class="bg-gray-800 rounded-lg overflow-hidden hover:bg-gray-700 transition-all flex items-center">
                            <div class="w-16 h-16 flex-shrink-0">
                                <img src="${track.cover}" alt="${track.title}" class="w-full h-full object-cover">
                            </div>
                            <div class="p-4 flex-grow overflow-hidden">
                                <h3 class="font-medium truncate">${track.title}</h3>
                                <p class="text-sm text-gray-400 truncate">${track.artist}</p>
                            </div>
                            <div class="p-4 flex items-center space-x-3">
                                <span class="text-xs text-gray-500">${track.duration}</span>
                                <button class="play-btn p-2 rounded-full hover:bg-gray-600" data-track='${JSON.stringify(track)}'>
                                    <i data-feather="play" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');

                    feather.replace();

                    // Add event listeners to play buttons
                    container.querySelectorAll('.play-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const track = JSON.parse(e.currentTarget.dataset.track);
                            const player = document.querySelector('custom-player');
                            if (player && player.playTrack) {
                                player.playTrack(track);
                            }
                        });
                    });
                }
            });
        </script>
    </main>

    <custom-player></custom-player>

    <script src="components/navbar.js"></script>
    <script src="components/player.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();

            const urlParams = new URLSearchParams(window.location.search);
            const mood = urlParams.get('mood');
            const playlistContainer = document.getElementById('playlistContainer');
            const emptyState = document.getElementById('emptyState');
            const clearPlaylistBtn = document.getElementById('clearPlaylist');
            const moodTitle = document.getElementById('moodTitle');

            if (mood) {
                moodTitle.textContent = `${mood.charAt(0).toUpperCase() + mood.slice(1)} Playlist`;
                loadMoodTracks(mood);
            } else {
                loadCurrentPlaylist();
            }

            clearPlaylistBtn.addEventListener('click', () => {
                clearPlaylist();
                playlistContainer.innerHTML = '';
                emptyState.classList.remove('hidden');
            });

            async function loadMoodTracks(mood) {
                try {
                    const tracks = await fetchMoodTracks(mood);
                    updatePlaylist(tracks);
                } catch (error) {
                    console.error('Error loading mood tracks:', error);
                }
            }

            function loadCurrentPlaylist() {
                const playlist = JSON.parse(localStorage.getItem('currentPlaylist'));
                if (playlist && playlist.length > 0) {
                    updatePlaylist(playlist);
                } else {
                    emptyState.classList.remove('hidden');
                }
            }

            function updatePlaylist(tracks) {
                if (tracks.length === 0) {
                    emptyState.classList.remove('hidden');
                    playlistContainer.innerHTML = '';
                    return;
                }

                emptyState.classList.add('hidden');
                playlistContainer.innerHTML = tracks.map((track, index) => `
                    <div class="bg-gray-800 rounded-lg overflow-hidden hover:bg-gray-700 transition-all flex items-center">
                        <div class="w-16 h-16 flex-shrink-0">
                            <img src="${track.cover}" alt="${track.title}" class="w-full h-full object-cover">
                        </div>
                        <div class="p-4 flex-grow overflow-hidden">
                            <h3 class="font-medium truncate">${track.title}</h3>
                            <p class="text-sm text-gray-400 truncate">${track.artist}</p>
                        </div>
                        <div class="p-4 flex items-center space-x-3">
                            <span class="text-xs text-gray-500">${track.duration}</span>
                            <button class="play-btn p-2 rounded-full hover:bg-gray-600" data-track='${JSON.stringify(track)}'>
                                <i data-feather="play" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                `).join('');

                feather.replace();

                // Add event listeners to play buttons
                document.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const track = JSON.parse(e.currentTarget.dataset.track);
                        const player = document.querySelector('custom-player').shadowRoot.querySelector('custom-player');
                        player.playTrack(track);
                    });
                });
            }
        });
    </script>
</body>

</html>